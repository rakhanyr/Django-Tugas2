{% extends 'base.html' %}


{% block meta %}
<title>Todolist: {{username}}</title>
<meta name="viewport", content="width=device-width, initial-scale=1.0">

<style>
    h1 {
    text-align: center;
    color: #ff0080;
    }
    p {
    text-align: left;
    }
</style>

{% endblock meta %}

{% block content %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    function loadData() {
        $.get(`/todolist/json`, function (data) {
            for (var i = 0; i < data.length; i++) {
                $(`#todo`).append(card(data[i]));
            }
        });
    }

    $(document).ready(function () {
        loadData();

        $('#add-task').click(function () {
            $.post(
                '/todolist/add/',
                {
                    title: $('#title').val(),
                    description: $('#description').val(),
                },
                function (data, status) {
                    if (status == 'success') {
                        $(`#todo`).append(card(data))
                        $('#title').val('')
                        $('#description').val('')
                    }
                },
            )
        })
    });

    const card = (data) =>
    `<div class="card" id="task-${data.pk}">
        <div>${data.fields.title}</div>
        <div>${data.fields.description}</div>
        <div>
            
            <div class="${data.fields.is_finished ? 'd-block' : 'd-none'}">Selesai</div>
            <div class="${data.fields.is_finished ? 'd-none' : 'd-block'}">Belum Selesai</div>
        </div>
        <div>
            <a onclick="updateCard(${data.pk})"><button type="submit" class="btn btn-danger">Update
                    Task</button></a>
            <a onclick="deleteCard(${data.pk})"><button type="submit" class="btn btn-danger">Delete
                    Task</button></a>
        </div>
        <div>${data.fields.date}</div>
    </div>`

    function deleteCard(id) {
        $.ajax({
            url: `/todolist/delete/${id}`,
            type: 'DELETE',
            success: function (result) {
                $(`#task-${id}`).remove()
            }
        });
    }


</script>


<nav class="navbar navbar-expand-lg bg-light" style="background-color:#ff0080;">
    <div class="container-fluid" style="background-color:#ff0080 ">
      <a class="navbar-brand" href="#" style="color:#ffffff;"> Todolist</a>
      <button type="button" class="btn btn-light"><a href="{% url 'todolist:logout' %}" class="link-light" style="background-color: #ff0080">Logout</a></button> 
    </div>
    </div>
  </nav> 
  <h1><span style="text-transform:uppercase"><strong>{{username}}'s</strong> TODOLIST</span></h1>

  <div id="taskCard" class="flex justify-center"></div>

  <div class="modal" id="modalCreate" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create Task</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="">
            <form method="POST" id="post-form">
              {% csrf_token %}
              <table>
                <tr>
                  <td>Todo:</td>
                  <td><input type="text" name="todo" placeholder="new todo" class="form-control" id="taskname"</td>
                </tr>
                <tr>
                  <td>Description:</td>
                  <td><input type="text" name="description" placeholder="Description" class="form-control" id="taskdesc"</td>
                </tr>
              </table>
              <input type="submit" name="submit" value="Create">
            </form>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <h5>Username: </h5>
  <p>{{user.username}}</p>


  <h5>Sesi Terakhir Login</h5>
  <p>{{last_login}}</p>
  
  <!-- {% for task in tasks %} -->
  <!-- <div class="card" style="width: 18rem;">
    <div class="card-body">
      <h5 class="card-title">{{task.title}}</h5>
      <h6 class="card-subtitle mb-2 text-muted">{{task.date}}</h6>
      <p class="card-text">{{task.description}}</p>
      <button class="btn btn-danger"><a href="{% url 'todolist:delete' task.id %}" class="link-light">Delete</a></button>
    </div>
  </div> -->
  <!-- {% endfor %} -->
  <!-- </div> -->

<p></p>
<button type="button" class="btn btn-primary"><a href="{% url 'todolist:create_task' %}" class="link-light">Tambah Task</a></button>

<button type="button" class="btn btn-primary"><a href="{% url 'todolist:logout' %}" class="link-light">Logout</a></button> 

{% endblock content %}